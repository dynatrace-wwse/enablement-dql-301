
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2-getting-started/">
      
      
        <link rel="next" href="../4-wrap-up/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>3. Data Transformation - Dynatrace Enablement Lab: DQL 301 - Data Transformation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/1612cf70810/bf81393wlb/ec2456210a428096_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-transformation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: DQL 301 - Data Transformation" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: DQL 301 - Data Transformation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: DQL 301 - Data Transformation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Data Transformation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-dql-301" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: DQL 301 - Data Transformation" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: DQL 301 - Data Transformation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Enablement Lab: DQL 301 - Data Transformation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-dql-301" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3. Data Transformation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3. Data Transformation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-data-with-data-and-append" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data with data and append
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding Data with data and append">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-notebook-into-dynatrace" class="md-nav__link">
    <span class="md-ellipsis">
      Import Notebook into Dynatrace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-raw-data-with-data" class="md-nav__link">
    <span class="md-ellipsis">
      Including Raw Data with data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-json-data-types-with-data" class="md-nav__link">
    <span class="md-ellipsis">
      Raw JSON Data Types with data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data-sets-with-append" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data Sets With append
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-data-with-join-and-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Data With join and lookup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connecting Data With join and lookup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-data-with-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Data With lookup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-the-entity-model-and-semantic-dictionary-with-describe" class="md-nav__link">
    <span class="md-ellipsis">
      Exploring the Entity Model and Semantic Dictionary with describe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topology-traversal-and-intent-passing-with-entityattr" class="md-nav__link">
    <span class="md-ellipsis">
      Topology Traversal and Intent Passing With entityAttr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flexible-data-connectivity-with-join" class="md-nav__link">
    <span class="md-ellipsis">
      Flexible Data Connectivity With join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-wrap-up/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Wrap Up
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-data-with-data-and-append" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data with data and append
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding Data with data and append">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-notebook-into-dynatrace" class="md-nav__link">
    <span class="md-ellipsis">
      Import Notebook into Dynatrace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-raw-data-with-data" class="md-nav__link">
    <span class="md-ellipsis">
      Including Raw Data with data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-json-data-types-with-data" class="md-nav__link">
    <span class="md-ellipsis">
      Raw JSON Data Types with data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data-sets-with-append" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data Sets With append
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-data-with-join-and-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Data With join and lookup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connecting Data With join and lookup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-data-with-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Data With lookup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-the-entity-model-and-semantic-dictionary-with-describe" class="md-nav__link">
    <span class="md-ellipsis">
      Exploring the Entity Model and Semantic Dictionary with describe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topology-traversal-and-intent-passing-with-entityattr" class="md-nav__link">
    <span class="md-ellipsis">
      Topology Traversal and Intent Passing With entityAttr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flexible-data-connectivity-with-join" class="md-nav__link">
    <span class="md-ellipsis">
      Flexible Data Connectivity With join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="data-transformation">Data Transformation<a class="headerlink" href="#data-transformation" title="Permanent link">#</a></h1>
<script>
document.addEventListener('DOMContentLoaded', function() {
  dynatrace.sendBizEvent('page_load', {"page": "3. Data Transformation"})
});
</script>

<p>In this lab module, we will explore how to transform data from various sources using <code>join</code>, <code>lookup</code>, <code>append</code>, and <code>data</code> commands. We will look at data from logs, traces, the entity model, and raw sources to accomplish this.</p>
<p><strong>Lab Tasks:</strong>
  1. Adding Data with <code>data</code> and <code>append</code>
  2. Connecting Data with <code>join</code> and <code>lookup</code>
  3. Wrap Up</p>
<h2 id="adding-data-with-data-and-append">Adding Data with <code>data</code> and <code>append</code><a class="headerlink" href="#adding-data-with-data-and-append" title="Permanent link">#</a></h2>
<h3 id="import-notebook-into-dynatrace">Import Notebook into Dynatrace<a class="headerlink" href="#import-notebook-into-dynatrace" title="Permanent link">#</a></h3>
<p><a href="https://github.com/dynatrace-wwse/enablement-dql-301/blob/main/assets/dynatrace/enablement-dql-301-data-transformation_notebook.json">Notebook</a></p>
<h3 id="including-raw-data-with-data">Including Raw Data with <code>data</code><a class="headerlink" href="#including-raw-data-with-data" title="Permanent link">#</a></h3>
<p>The <code>data</code> command provides an easy way to add any data you care about into a Notebook, Dashboard, Workflow, or any other component that uses DQL. This is most useful when pulling in data from other sources (i.e., Excel, CSV, etc.) or consolidating data from another query into a DQL statement. </p>
<p>Syntax:
<div class="highlight"><pre><span></span><code>data record(key=value1),
record(key=value2,key2=value3), ...
</code></pre></div></p>
<p>For example, let's say your customer has a product name on all their key applications, placed as tag metadata on those entities in Dynatrace. This value, <code>DT_RELEASE_PRODUCT</code>, does not change often; the customer only adds new apps every 6 months. Therefore, if we use a query to return those <code>DT_RELEASE_PRODUCT</code> values, we can then build them as a new <code>data</code> array for subsequent queries without having to have to run a DQL <code>fetch</code>.</p>
<p>Extract the tags as a string for all of the process group instances (PGIs) in the environment, and parse out the <code>DT_RELEASE_PRODUCT</code> values.
<div class="highlight"><pre><span></span><code>fetch dt.entity.process_group_instance
| fieldsAdd tags
| fieldsAdd tagsToString = toString(tags)
| parse tagsToString, &quot;&quot;&quot;DATA &#39;DT_RELEASE_PRODUCT:&#39; LD:productName &#39;\&quot;,&#39; DATA EOF&quot;&quot;&quot;
| filter isNotNull(productName)
| summarize count=count(), by:{productName}
</code></pre></div></p>
<p>Your customer then tells you that they have different business units and business criticality values based on what application / product is in use. Those business units and criticality values are outlined in the table below.</p>
<table>
<thead>
<tr>
<th>Product Name</th>
<th>Business Unit</th>
<th>Criticality</th>
</tr>
</thead>
<tbody>
<tr>
<td>EasyTrade</td>
<td>Financial Services</td>
<td>HI</td>
</tr>
<tr>
<td>EasyTravel</td>
<td>Retail</td>
<td>HI</td>
</tr>
<tr>
<td>HipsterShop</td>
<td>Retail</td>
<td>LO</td>
</tr>
</tbody>
</table>
<p>Let's build out the <code>data</code> array to include <code>productName</code>, <code>businessUnit</code>, and <code>criticality</code> record values accordingly:
<div class="highlight"><pre><span></span><code>data record(productName=&quot;easytrade&quot;,businessUnit=&quot;Financial Services&quot;,criticality=&quot;HI&quot;),
record(productName=&quot;easytravel&quot;,businessUnit=&quot;Retail&quot;,criticality=&quot;HI&quot;),
record(productName=&quot;hipstershop&quot;,businessUnit=&quot;Retail&quot;,criticality=&quot;LO&quot;)
</code></pre></div></p>
<p>You can now associate these new fields for <code>businessUnit</code> and <code>criticality</code> to any other entity that has the <code>productName</code> tag attached to it. </p>
<p>To improve query performance, you can run a query once to get the fields you care about and then reuse that static or quasi-static field in other queries. Say you want to understand your application requests from the perspective of what OS version their underlying compute is running (Amazon Linux, Ubuntu Bionic Beaver, etc.). You want to know this because you are trying to plan for patching cycles and how you will maintain those systems for different, high-throughput apps. You know that these OS versions are LTS, and therefore constant. </p>
<p>Let's look at the query which would gather those OS versions:</p>
<div class="highlight"><pre><span></span><code>fetch spans, from:now()-1h, to:now() 
| fieldsAdd dt.entity.service
| fieldsAdd dt.entity.service.id = entityAttr(dt.entity.service,&quot;id&quot;)
| fieldsAdd dt.entity.service.entity.name = entityName(dt.entity.service)
| fieldsAdd pgiRunsOn = entityAttr(dt.entity.service,&quot;runs_on&quot;)
| fieldsAdd pgiIds = pgiRunsOn[dt.entity.process_group_instance]
| expand pgiId = pgiIds
| join
[
  fetch dt.entity.process_group_instance
  | fieldsAdd id, entity.name
  | fieldsAdd hostId = belongs_to[dt.entity.host]
], on:{left[pgiId]==right[id]}, kind:{inner}, prefix:&quot;pgi.&quot;
| join
[
  fetch dt.entity.host
  | fieldsAdd id, entity.name
  | fieldsAdd osVersion
], on:{left[pgi.hostId]==right[id]}, kind:{inner}, prefix:&quot;host.&quot;
| fields dt.entity.service.entity.name, dt.entity.service.id, host.entity.name, host.osVersion
| filter contains(host.osVersion, &quot;Ubuntu&quot;)
| summarize count=countDistinct(host.osVersion), by:{host.osVersion,dt.entity.service.id}
| fieldsAdd dataRecord = concat(&quot;record(dt.entity.service.id=\&quot;&quot;,dt.entity.service.id,&quot;\&quot;,hostOs=\&quot;&quot;,host.osVersion,&quot;\&quot;),&quot;)
| limit 10
</code></pre></div>
<p><strong>⏩ Try it out</strong>: Now, see if you can take the column <code>dataRecord</code> and copy it into another query after the <code>// ADD QUERY HERE</code> line. Run that query and the subsequent one without the <code>data</code> record. Note the differences in performance.  </p>
<p>Snippet:
<div class="highlight"><pre><span></span><code>fetch spans, from:now()-1h, to:now() 
| fieldsAdd dt.entity.service
| fieldsAdd dt.entity.service.id = entityAttr(dt.entity.service,&quot;id&quot;)
| fieldsAdd dt.entity.service.entity.name = entityName(dt.entity.service)
| join
[ 
// ADD QUERY HERE

], on:{dt.entity.service.id}, kind:{inner}, prefix:&quot;host.&quot;
| fieldsRemove host.dt.entity.service.id
| fields trace.id, span.id, dt.entity.service.entity.name, span.name, host.hostOs, duration
| summarize count=count(), by:{dt.entity.service.entity.name, host.hostOs}
| sort count desc
</code></pre></div>
In the screenshots below, you can clearly see the difference in performance with <code>data</code> and without it.</p>
<p>With <code>data</code>:
<img alt="With data Record Performance" src="../img/with_data_record_performance.png" /></p>
<p>Without <code>data</code>:
<img alt="No data Record Performance" src="../img/no_data_record_performance.png" /></p>
<p>The ability to add data on demand - particularly for non-DQL data sources and for quasi-static, long-running DQL queries - is a powerful way to add data into your DQL statements.</p>
<h3 id="raw-json-data-types-with-data">Raw JSON Data Types with <code>data</code><a class="headerlink" href="#raw-json-data-types-with-data" title="Permanent link">#</a></h3>
<p>The <code>data</code> <a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/commands/data-source-commands#data">command</a> allows you to also pull in raw JSON content. </p>
<p>The following is an example for nested JSON:
<div class="highlight"><pre><span></span><code>data json:&quot;&quot;&quot;[
  {
    &quot;dataRecord&quot;: {
      &quot;name&quot;: &quot;jwoo1&quot;,
      &quot;depositAmount&quot;: 112,
      &quot;bankAccountId&quot;: 1234,
      &quot;properties&quot;:
      {
        &quot;type&quot;: &quot;savings&quot;,
        &quot;interestRate&quot;: 0.0045,
        &quot;relatedAccounts&quot;:
        {
          &quot;savings&quot;: &quot;N/A&quot;,
          &quot;checking&quot;: &quot;2341&quot;,
          &quot;mmf&quot;: &quot;1493&quot;
        }
      }
    }
  },
  {
    &quot;dataRecord&quot;: {
      &quot;name&quot;: &quot;jdoe2&quot;,
      &quot;depositAmount&quot;: 343,
      &quot;bankAccountId&quot;: 1120,
      &quot;properties&quot;:
      {
        &quot;type&quot;: &quot;checking&quot;,
        &quot;interestRate&quot;: 0.00325,
        &quot;relatedAccounts&quot;:
        {
          &quot;savings&quot;: &quot;3001&quot;,
          &quot;checking&quot;: &quot;N/A&quot;,
          &quot;mmf&quot;: &quot;8843&quot;
        }
      }
    }
  },
  {
    &quot;dataRecord&quot;: {
      &quot;name&quot;: &quot;jdoe3&quot;,
      &quot;depositAmount&quot;: 8433,
      &quot;bankAccountId&quot;: 1555
    }
  },
  {
    &quot;dataRecord&quot;: {
      &quot;name&quot;: &quot;batman4&quot;,
      &quot;depositAmount&quot;: 8433413,
      &quot;bankAccountId&quot;: 1000,
      &quot;properties&quot;:
      {
        &quot;type&quot;: &quot;savings&quot;,
        &quot;interestRate&quot;: 0.0055,
        &quot;relatedAccounts&quot;:
        {
          &quot;savings&quot;: &quot;N/A&quot;,
          &quot;checking&quot;: &quot;3499&quot;,
          &quot;mmf&quot;: &quot;2224&quot;
        }
      }
    }
  }
]&quot;&quot;&quot;
</code></pre></div></p>
<p><strong>⏩ Try it out</strong>: For that example, copy the <code>data</code> record into your Notebook and determine the median deposit amount (<code>depositAmount</code>) from the data. </p>
<p>Nested JSON like the example in the <code>data</code> record can be more easily parsed if flatted accordingly. This can be accomplished by using <code>fieldsFlatten</code>: <a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/commands/structuring-commands#fieldsFlatten">Documentation</a>. For JSON fields, you can provide a <code>depth</code> argument that then automatically extracts nested JSON fields and places those keys as their own variables in the record.</p>
<p>For nested, lengthy JSON records, the <code>fieldsKeep</code> command proves useful: <a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/commands/selection-and-modification-commands#fieldsKeep">Documentation</a>. The <code>fieldsKeep</code> command retains only the records that match either an exact key or a key with wildcards. An example wildcard pattern for the above would be: <code>fieldsKeep "dataRecord.name*"</code></p>
<p>In the case of that <code>fieldsKeep</code> pattern, only the <code>name</code> nested JSON keys and their respective values would be kept. Wildcards can be applied either as prefixes or suffixes (i.e., before and after the matching pattern).</p>
<p><strong>⏩ Try it out</strong>: Using <code>fieldsFlatten</code>, <code>depth</code>, and <code>fieldsKeep</code>, count how many <code>relatedAccounts.savings</code> keys are defined.</p>
<h3 id="adding-data-sets-with-append">Adding Data Sets With <code>append</code><a class="headerlink" href="#adding-data-sets-with-append" title="Permanent link">#</a></h3>
<p>The <code>append</code> command (<a href="">Documentation</a>) is one of three ways to add data to an existing DQL data set. This command behaves similarly to a <strong>SQL UNION ALL</strong> operation between two data sets <code>A</code> (i.e., "left") and <code>B</code> (i.e., "right"). A diagram showing that is below, highlighting the fact that the two sets have no excluded intersection and that the two sets may have duplicate values. However, the keys will still remain unique.</p>
<p><img alt="append Set Logic" src="../img/append_set_diagram.png" /></p>
<p>Example syntax for a DQL <code>fetch</code>:
<div class="highlight"><pre><span></span><code>fetch logs
| fieldsAdd keyValue=&quot;test&quot;
| limit 10
| append
[
   data record(keyValue=&quot;test2&quot;, content=&quot;Hello World&quot;)
]
</code></pre></div>
In that example case, log records will have an additional key added to the records, <code>keyValue</code>, and its value will be fixed as <code>test</code>. With the <code>append</code> command, the <code>keyValue</code> key will have the value <code>test2</code> added as a record. Further, the <code>content</code> key from the previous log DQL statement will have the value <code>Hello World</code>. Therefore, the total record count from the query will be 11, 10 from the logs and 1 from the <code>append</code>, with the keys <code>keyValue</code> and <code>content</code> having non-null entries on all records. </p>
<p>A potentially useful scenario for <code>append</code> is when you have multiple metric queries that you want to "glue" together, regardless of whether you have a common value between <code>A</code> ("left") and <code>B</code> ("right"). For instance, if you wanted to show the timeseries for host idle CPU over the last 2 hours and in the same window 7 days ago, you could accomplish that with <code>append</code>, as seen below. </p>
<p>Another useful scenario is to combine metrics and logs on the same entity, namely, a host or a PGI.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>timeseries cpuIdle=avg(dt.host.cpu.idle), by: { host.name }, filter: { matchesValue(host.name, &quot;ip-172-31-23-111.ec2.internal&quot;) }
| fieldsAdd cpuIdleAvg = arrayAvg(cpuIdle)
| append
[
  timeseries cpuIdle7dShift = avg(dt.host.cpu.idle), by: { host.name }, filter: { matchesValue(host.name, &quot;ip-172-31-23-111.ec2.internal&quot;) }, shift: -168h
  | fieldsAdd cpuIdleAvg7dShift = arrayAvg(cpuIdle7dShift)
]
</code></pre></div>
<img alt="append for host idle CPU" src="../img/host_idle_cpu_append.png" /></p>
<p><strong>⏩ Try it out</strong>: Let's say you're investigating a JVM memory leak on host <code>i-0d8d16e6f7c82fd48</code>. To do so, we would like to get the heap details for that host combined with the server's logs. Using <code>append</code>, stitch together the heap metric (hint: <code>dt.runtime.jvm.memory_pool.used</code>) with the <code>WARN</code> and <code>ERROR</code> logs for that host. Make a timeseries for the log count (hint: <code>| makeTimeseries count=count()</code>), and plot both timeseries on the same time selection (e.g., <strong>Last 2 hours</strong>).  </p>
<h2 id="connecting-data-with-join-and-lookup">Connecting Data With <code>join</code> and <code>lookup</code><a class="headerlink" href="#connecting-data-with-join-and-lookup" title="Permanent link">#</a></h2>
<h3 id="connecting-data-with-lookup">Connecting Data With <code>lookup</code><a class="headerlink" href="#connecting-data-with-lookup" title="Permanent link">#</a></h3>
<p>The <code>lookup</code> command (<a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/commands/correlation-and-join-commands#lookup">documentation</a>) adds (joins) fields from a subquery (the lookup table, set <code>B</code>, the "right") to the source table (set <code>A</code>, the "left") by finding a match between a field in the source table (<code>sourceField</code>) and the lookup table (<code>lookupField</code>). </p>
<p>This mimics a SQL INNER JOIN, but it is not quite the same as an INNER JOIN, as <code>lookup</code> only returns the first matching result between <code>A</code> ("left") and <code>B</code> ("right"). Additional matches are disregarded.</p>
<p><img alt="lookup Set Logic" src="../img/lookup_set_diagram.png" /></p>
<p>Other points to note about <code>lookup</code>:
* Null Values: If the key values are null for <code>sourceField</code> and <code>lookupField</code>, then those records are not returned, as well. 
* Nesting: <code>lookup</code> function nests all included fields as a record.
* Execution Order: By default, this is set to <code>auto</code>, which corresponds to the left (<code>A</code>) table being the source and the right (<code>B</code>) table being the lookup table. This can be changed to <code>leftFirst</code> or <code>rightFirst</code>, depending on what you are trying to do.</p>
<p>Example query for <code>lookup</code> for service IDs from log records:
<div class="highlight"><pre><span></span><code>fetch logs
| lookup 
[
  fetch dt.entity.service
  | fieldsAdd id
  | fieldsAdd entity.name
], sourceField: dt.source_entity, lookupField:id, prefix:&quot;service.&quot;
| filter isNotNull(service.entity.name)
</code></pre></div></p>
<p>In the example, the log records have source entities that can be services (i.e., <code>dt.entity.service</code>). We want to match source entities that are services against the right (<code>B</code>) table in the Dynatrace entity model that has additional service details, like name, PGI the service runs on, and so on. </p>
<p>To do that, we fetch records from <code>dt.entity.service</code> and match the source entity ID (<code>dt.source_entity</code>) with the entity ID from <code>dt.entity.service</code>. While <code>entity.name</code> and <code>id</code> are fields that are added by default with a <code>fetch</code> for entities in the entity model, it is good practice to add them as separate fields regardless, making the mapping of <code>sourceField</code> to <code>lookupField</code> more intuitive. Finally, the <code>prefix:</code> field allows you to place text in front of all keys in the result of the <code>lookup</code>. </p>
<p><code>prefix:</code> will also manifest again when we discuss <code>join</code>.</p>
<p>Please note that <code>lookup</code> only returns the <em>first</em> match for the left (<code>A</code>) and right (<code>B</code>) tables. That is apparent from this example DQL snippet and the screenshot below:</p>
<div class="highlight"><pre><span></span><code>data record(a=2),
record(a=4),
record(a=6)
| lookup 
[
  data record(a=2),
  record(a=2),
  record(a=3)
], sourceField: a, lookupField: a, prefix:&quot;lookup.&quot;
</code></pre></div>
<p><img alt="A &amp; B Tables, lookup" src="../img/left_and_right_tables_lookup.png" /></p>
<p><strong>⏩ Try it out</strong>: Following the DQL snippet below, <code>lookup</code> the names of the services running on a given process group. Note that you will need to add in the second <code>lookup</code>.  </p>
<p><div class="highlight"><pre><span></span><code>fetch logs
| filter log.source == &quot;/home/ubuntu/.dynaTrace/easyTravel 2.0.0/easyTravel/log/BusinessBackend.log&quot;
| lookup 
[
  fetch dt.entity.process_group_instance
  | fieldsAdd id
  | fieldsAdd entity.name
  | fieldsAdd services=runs[dt.entity.service]
  | expand serviceId=services
], sourceField: dt.source_entity, lookupField:id, prefix:&quot;pgi.&quot;
| filter isNotNull(pgi.entity.name)
| lookup 
[

]
</code></pre></div>
Once successful, you will notice that <code>BookingService</code> is the only service name returned. More on why that's the case later....</p>
<h3 id="exploring-the-entity-model-and-semantic-dictionary-with-describe">Exploring the Entity Model and Semantic Dictionary with <code>describe</code><a class="headerlink" href="#exploring-the-entity-model-and-semantic-dictionary-with-describe" title="Permanent link">#</a></h3>
<p>A quite common scenario when using <code>lookup</code> or <code>join</code> is the need to map the relationships between one key in an observability facet (log, trace, metric) to either another facet or to the topology model itself. A powerful resource for that is the Dynatrace <a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/semantic-dictionary">semantic dictionary</a>, a reference that outlines the standards used for monitoring data in Dynatrace and their respective domain-specific data models. </p>
<p>Using DQL, a quick way to determine what data model fields are present for a given data object / entity is by using <code>describe</code>. By running <code>describe</code>, Dynatrace will retrieve the on-read schema definition for that data object. </p>
<p>Syntax:
<div class="highlight"><pre><span></span><code>describe entityObject
</code></pre></div></p>
<p>For instance, if you run <code>describe dt.entity.process_group_instance</code>, you will then know all the possible fields and their data types for the PGI entity in the entity model. Many entity queries will only return the <code>id</code> and <code>entity.name</code> fields on a <code>fetch</code>, and therefore you will need to use <code>describe</code> and the semantic dictionary to ascertain what other fields to add to the <code>fetch</code>. </p>
<p>As a way to "automate" the field addition for given <code>fetch</code>, let's use that <code>describe dt.entity.process_group_instance</code> call, export the result as a CSV, and then open the output in Excel. From Excel, we can transform the <code>field</code> column to add in all fields to a <code>fetch</code> using the Excel formula below:</p>
<p><div class="highlight"><pre><span></span><code>=CONCAT(&quot;| fieldsAdd &quot;,A2) 
</code></pre></div>
(propagate <code>A2</code> to <code>A3</code>, <code>A4</code>, etc.)</p>
<p>The result should look something like the screenshot below.
<img alt="describe Output in Excel" src="../img/describe_excel.png" />
<img alt="describe Fields Added in DQL" src="../img/describe_output.png" /></p>
<p>For convenience, a summary of common topologies for the application, service, process, and host entities is given in the table below. The table will often get you a majority of the relationships that you would care about for these entities.</p>
<table>
<thead>
<tr>
<th>Entity model call</th>
<th><code>belongs_to</code></th>
<th><code>instance_of</code></th>
<th><code>calls</code></th>
<th><code>called_by</code></th>
<th><code>runs</code></th>
<th><code>runs_on</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dt.entity.application</code></td>
<td><em>N/A</em></td>
<td><em>N/A</em></td>
<td>Outbound calls to services (RUM to server-side correlation)</td>
<td><em>N/A</em></td>
<td><em>N/A</em></td>
<td><em>N/A</em></td>
</tr>
<tr>
<td><code>dt.entity.service</code></td>
<td>Cloud application instance, namespace, container group, and/or queue that the service belongs to</td>
<td><em>N/A</em></td>
<td>Outbound calls to other services</td>
<td>Inbound calls from other services</td>
<td><em>N/A</em></td>
<td>PGI, PG, and host service runs on</td>
</tr>
<tr>
<td><code>dt.entity.process_group_instance</code></td>
<td>Host that the PGI runs on</td>
<td>Process group (PG) corresponding to PGI</td>
<td>Outbound calls to other PGIs</td>
<td>Inbound calls from other PGIs</td>
<td>Services running on the PGI</td>
<td><em>N/A</em></td>
</tr>
<tr>
<td><code>dt.entity.process_group</code></td>
<td>Cloud application instance, namespace, and container group that the PG runs on</td>
<td><em>N/A</em></td>
<td>Outbound calls to other PGs</td>
<td>Inbound calls from other PGs</td>
<td>Services running on the PG</td>
<td>Hosts the PG runs on</td>
</tr>
<tr>
<td><code>dt.entity.host</code></td>
<td>Data center / AZ / region that the host runs on</td>
<td>Host group corresponding to the host, if defined</td>
<td>Outbound calls to other hosts</td>
<td>Inbound calls from other hosts</td>
<td>PGs running on the host</td>
<td>Cloud or VM instance corresponding to host</td>
</tr>
</tbody>
</table>
<p><strong>⏩ Try it out</strong>: Determine how many load balancer data fields are present in the Dynatrace data model for an AWS application load balancer. </p>
<p><strong>⏩ Try it out</strong>: Starting with the DQL snippet for a host system CPU timeseries (see below), use <code>describe</code> and <code>lookup</code> to figure out the AWS Availability Zone for that server. You will need two <code>lookup</code> commands.</p>
<p>Snippet:
<div class="highlight"><pre><span></span><code>timeseries avg(dt.host.cpu.system), by: { host.name, dt.entity.host }, filter: { matchesValue(host.name, &quot;ip-172-31-23-111.ec2.internal&quot;) }
| fieldsAdd value.A = arrayAvg(`avg(dt.host.cpu.system)`)
| fieldsAdd hostId = entityAttr(dt.entity.host, &quot;id&quot;)
| lookup 
[

]
| lookup
[

]
</code></pre></div></p>
<p>Output:
<img alt="AWS Availability Zone" src="../img/lookup_aws_az.png" /></p>
<h3 id="topology-traversal-and-intent-passing-with-entityattr">Topology Traversal and Intent Passing With <code>entityAttr</code><a class="headerlink" href="#topology-traversal-and-intent-passing-with-entityattr" title="Permanent link">#</a></h3>
<p>In the last exercise, note the use of the command <code>entityAttr</code>: <a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/functions/general-functions#entity-attr">Documentation</a>. This command allows you to traverse the Dynatrace data model for a given entity (for example, <code>dt.entity.host</code>) on a particular field for that model. However, to do that, you need to know the fields that you have for that data object, likely requiring you to use <code>describe</code> to get those details.</p>
<p>Let's say you wanted to grab all outbound PGI callers for a particular PGI using <code>entityAttr</code>. You're getting that process information from its CPU usage. To do that, you could first describe <code>dt.entity.process_group_instance</code> and find the fields for that data object. Then, you would find the fields you care about and call them out for that data object with the following approach:</p>
<div class="highlight"><pre><span></span><code>timeseries avg(dt.process.cpu.usage), by: { dt.entity.process_group_instance }
| fieldsAdd entity.name = entityName(dt.entity.process_group_instance)
| fieldsAdd id = entityAttr(dt.entity.process_group_instance, &quot;id&quot;)
| fieldsAdd calls = entityAttr(dt.entity.process_group_instance, &quot;calls&quot;)
| fieldsAdd outboundPGICount = arraySize(calls[dt.entity.process_group_instance])
| expand outboundPGI = calls[dt.entity.process_group_instance]
</code></pre></div>
<p>Here, the <code>dt.entity.process_group_instance</code> data object has additional semantic details added via <code>entityAttr</code> with the <code>id</code> and <code>calls</code> lines. For any data object, you can use <code>entityName</code> to return the <code>entity.name</code> field for that object. <code>calls</code> is what is used for outbound PGI callers, and that line then returns an array of PGIs that are called by a particular process. As such, you can get a count of the outbound PGIs from that process by using <code>arraySize</code>, and then you can map the individual PGIs themselves through an <code>expand</code>. </p>
<p>To map the array elements appropriately, you need to call the suitable object for that topological link; for <code>calls</code> and <code>called_by</code> with <code>dt.entity.process_group_instance</code>, you will use <code>dt.entity.process_group_instance</code>, but this could vary based on what you are linking topologically. For example, if you were referencing <code>runs</code> with <code>dt.entity.process_group_instance</code>, you would want to return a list of services, and therefore you would use <code>dt.entity.service</code> instead.</p>
<p>When you use <code>entityAttr</code>, your queries are enriched with the entity model, thereby allowing you to pass intents between apps. In turn, you can perform an <strong>Open record with</strong> to other apps on records returned by a query. Without <code>entityAttr</code>, you often will unable to pass intents appropriately, preventing you from opening the record elsewhere.</p>
<p><strong>⏩ Try it out</strong>: Take the previous snippet and modify it to get the process group (PG) name using <code>entityAttr</code>. Open the PG in another app with <strong>Open record with</strong>. Which entity is passed through the intent?</p>
<h3 id="flexible-data-connectivity-with-join">Flexible Data Connectivity With <code>join</code><a class="headerlink" href="#flexible-data-connectivity-with-join" title="Permanent link">#</a></h3>
<p>The <code>join</code> command (<a href="https://docs.dynatrace.com/docs/discover-dynatrace/references/dynatrace-query-language/commands/correlation-and-join-commands#join">documentation</a>) adds (joins) fields from a subquery (set <code>B</code>, the "right") to the source table (set <code>A</code>, the "left"). The <code>join</code> can be done with three different <code>kind</code> values:</p>
<table>
<thead>
<tr>
<th><code>join</code> type</th>
<th><code>kind</code> value</th>
<th>Description</th>
<th>SQL Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inner Join</td>
<td><code>kind: inner</code></td>
<td>Returns only the matching records from both tables (<code>A</code> and <code>B</code>).</td>
<td>SQL INNER JOIN</td>
</tr>
<tr>
<td>Left Outer Join</td>
<td><code>kind: leftOuter</code></td>
<td>Returns all records from the left table (<code>A</code>) and the matching records from the right table (<code>B</code>). If no match is found, the result will be <code>null</code> for the right table's fields.</td>
<td>SQL LEFT OUTER JOIN</td>
</tr>
<tr>
<td>Outer Join</td>
<td><code>kind: outer</code></td>
<td>Returns all matching and non-matching records from the left table (<code>A</code>) and the right table (<code>B</code>).</td>
<td>SQL OUTER JOIN</td>
</tr>
</tbody>
</table>
<p><strong>Inner Join</strong>
<img alt="Inner Join" src="../img/inner_join_set_diagram.png" /></p>
<p><strong>Left Outer Join</strong>
<img alt="Left Outer Join" src="../img/left_outer_join_set_diagram.png" /></p>
<p><strong>Outer Join</strong>
<img alt="Outer Join" src="../img/outer_join_set_diagram.png" /></p>
<p>Let's walk through an example query for an inner <code>join</code> for service IDs from log records:
<div class="highlight"><pre><span></span><code>fetch logs
| join
[
  fetch dt.entity.service
  | fieldsAdd id
  | fieldsAdd entity.name
], kind:{inner}, on:{left[dt.source_entity] == right[id]}, prefix: &quot;service.&quot;
| filter isNotNull(service.entity.name)
</code></pre></div></p>
<p>Similar to a <code>lookup</code>, we are mapping the field <code>dt.source_entity</code> in the left (<code>A</code>) table to service IDs in the right (<code>B</code>) table. The mapping is accomplished by the line: <code>on:{left[dt.source_entity] == right[id]}</code>. To use an inner join, we set <code>kind:{inner}</code>. Finally, we add a prefix "service." to all resulting entries. Like <code>lookup</code>, it is good practice to place the right-side mapping field (here, <code>id</code>) in the query, as well as <code>entity.name</code>. </p>
<p>If there are no matches between the left (<code>A</code>) table and the right (<code>B</code>) table, then, for a <code>join</code> using <code>kind:{inner}</code>, you will have no records returned. Unlike <code>lookup</code>, <code>join</code> will match past the first record. </p>
<p>Using a left outer join (i.e., <code>kind:{leftOuter}</code>) is useful for finding both matching and non-matching records, as those that do not match on the right (<code>B</code>) table will return as null. In this scenario, you are guaranteed to return some records, with <em>null</em> values for non-matches. </p>
<p>Let's look at this for a similar version of the previous DQL logs snippet. In this case, we have adjusted the service ID with <code>concat</code> to deliberately break the matches for the right table on a <code>leftOuter</code> join.</p>
<div class="highlight"><pre><span></span><code>fetch logs
| join
[
  fetch dt.entity.service
  | fieldsAdd id
  | fieldsAdd newId = concat(id,&quot;1&quot;)
  | fieldsAdd entity.name
], kind:{leftOuter}, on:{left[dt.source_entity] == right[newId]}, prefix: &quot;service.&quot;
| limit 10
</code></pre></div>
<p>Run this with both <code>leftOuter</code> and <code>inner</code> joins. You will notice that <code>leftOuter</code> returns records with null fields while <code>inner</code> does not. </p>
<p><img alt="leftouter and inner" src="../img/leftouter_and_inner_same_query.png" /></p>
<p><strong>⏩ Try it out</strong>: Starting with the snippet below, modify it so that you can determine the single value percentage of EC2 instances in the environment. Hint: on your <code>summarize</code>, you will need to use a <code>countIf</code>. What happens when you change the <code>kind:</code> value for <code>join</code>?</p>
<div class="highlight"><pre><span></span><code>timeseries avg(dt.host.cpu.usage), by: { dt.entity.host }
| fieldsAdd dt.entity.host.name = entityName(dt.entity.host)
| fieldsAdd value.A = arrayAvg(`avg(dt.host.cpu.usage)`)

...
| fields ec2Percentage
</code></pre></div>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<!--TODO: Update Continue Section -->
<p>In the next section, we'll wrap up what we've learned in this lab today. </p>
<div class="grid cards">
<ul>
<li><a href="../4-wrap-up/">Continue To Wrap Up<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>